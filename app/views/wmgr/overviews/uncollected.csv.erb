<%- headers = ['People', 'Grade', 'Last', 'First', 'Minutes Read', 'Pledge Id', 'Pledge Email', 'Pledge Request', 'Pledge Nick Name', 'Pledge Type', 'Pledge Amount', 'Pledge Min', 'Pledge Max', 'Amount Owed'] -%>
<%= CSV.generate_line headers -%>
<%=
  CSV.generate do |csv|
    @pledges.each do |pledge|
      csv << [
          pledge.student.teacher.last,
          pledge.student.teacher.grade,
          pledge.student.last,
          pledge.student.first,
          pledge.student.total_minutes_read,
          pledge.id,
          pledge.email,
          pledge.email_sent_date.nil? ? "" : pledge.email_sent_date.strftime("%m/%d/%Y"),
          pledge.name,
          pledge.ptype,
          pledge.amount,
          pledge.min_amt,
          pledge.max_amt,
          pledge.total_owed
      ]
p "!!! #{pledge.student.last} #{pledge.student.first}  minutes: #{pledge.student.total_minutes_read}  amount: #{pledge.amount.to_f}  hours: #{(pledge.student.total_minutes_read.to_f/60.to_f)}  total: #{(pledge.student.total_minutes_read.to_f/60.to_f) * pledge.amount.to_f}  total: #{pledge.total_owed}"
    end
  end.html_safe
%>
